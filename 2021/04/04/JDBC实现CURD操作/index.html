<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="使用PreparedStatement实现CRUD操作：操作和访问数据库：
数据库连接被用于向数据库服务器发送命令和sql语句，并接受数据库服务器返回的结果。其实一个数据库连接就是一个Socket连接。

在java.sql包中有3个接口分别定义了对数据库的调用的不同方式：

Statement：用">
    

    <!--Author-->
    
        <meta name="author" content="7heng">
    

    <!-- Title -->
    
    <title>JDBC实现CURD操作 | Heng</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Noto+Serif:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- jQuery -->
    <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Heng" type="application/atom+xml">
</head>

<body>

    <!-- Content -->
    <section class="article-container">
    <!-- Back Home -->
    <a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

        <!-- Page Header -->
        <header class="intro-header">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <div class="post-heading">
                            <h1>
                                JDBC实现CURD操作
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Post Content -->
        <article>
            <div class="container">
                <div class="row">
                    <!-- Post Main Content -->
                    <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <h2 id="使用PreparedStatement实现CRUD操作："><a href="#使用PreparedStatement实现CRUD操作：" class="headerlink" title="使用PreparedStatement实现CRUD操作："></a>使用PreparedStatement实现CRUD操作：</h2><h3 id="操作和访问数据库："><a href="#操作和访问数据库：" class="headerlink" title="操作和访问数据库："></a><strong>操作和访问数据库：</strong></h3><ul>
<li><p>数据库连接被用于向数据库服务器发送命令和sql语句，并接受数据库服务器返回的结果。其实一个数据库连接就是一个Socket连接。</p>
</li>
<li><p>在java.sql包中有3个接口分别定义了对数据库的调用的不同方式：</p>
<ul>
<li>Statement：用于执行静态sql语句并返回它所生成结果的对象。</li>
<li>PrepartedStatement：SQL语句被预编译并存储在此对象中，可以使用此对象多次高效地执行该语句。</li>
<li>CallbleStatement：用于执行SQL存储过程。</li>
</ul>
<p><img src="/images/JDBC_1/Curd.png"></p>
</li>
</ul>
<h4 id="使用Statment操作数据表的弊端："><a href="#使用Statment操作数据表的弊端：" class="headerlink" title="使用Statment操作数据表的弊端："></a>使用Statment操作数据表的弊端：</h4><ul>
<li>通过调用Connection对象的createStatement()方法创建该对象。该对象用于执行静态的SQL语句，并且返回执行过程。</li>
<li>Statment 接口中定义了下列方法用于执行SQL语句：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int excuteUpdate(String sql)：执行更新操作INSERT、UPDATE、DELETE</span><br><span class="line">ResultSet executeQuery(String sql)：执行查询操作SELECT</span><br></pre></td></tr></table></figure>

<ul>
<li><p>但是使用Staement操作数据表存在弊端：</p>
<ul>
<li><strong>问题一：存在拼串操作，繁琐</strong>。</li>
<li><strong>问题二：存在SQL注入问题</strong>。</li>
</ul>
</li>
<li><p>SQL注入是利用某些系统没有对用户输入的数据进行充分的检查，而在用户输入数据中注入非法的SQL语句段或命令(如：SELECT user, password FROM user_table WHERE user=’a’ OR 1 = ‘ AND password = ‘ OR ‘1’ = ‘1’)，从而利用系统的SQL引擎完成恶意行为的做法。</p>
</li>
<li><p>对于java而言，要防范SQL注入，只要用PreparedStatement(从Statment扩展而来)取代Statement就可以了。</p>
</li>
<li><p>代码演示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">public class StatmentTest&#123;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F; 使用 Statment的弊端：需要拼写sql语句，并且存在SQL注入的问题。</span><br><span class="line">	@Test</span><br><span class="line">	public void testLogin()&#123;</span><br><span class="line">		Scanner scan &#x3D; new Scanner(System.in);</span><br><span class="line">		</span><br><span class="line">		System.out.print(&quot;用户名：&quot;);</span><br><span class="line">		String userName &#x3D; scan.mextLine();</span><br><span class="line">		System.out.print(&quot;密 码&quot;);</span><br><span class="line">		String password &#x3D; scan.nextLine();</span><br><span class="line">		</span><br><span class="line">		&#x2F;&#x2F; SELECT user.password FROM user_table WHERE USER &#x3D; &#39;1&#39; or &#39;AND&#39; PASSWORD &#x3D; &#39;&#x3D;&#39;1&#39; or &#39;1&#39; &#x3D; &#39;1&#39;;</span><br><span class="line">        String sql &#x3D; &quot;SELECT user,password FROM user_table WHERE USER &#x3D; &#39;&quot; + userName + &quot;&#39; AND PASSWORD &#x3D; &#39;&quot; + password + &quot;&#39;&#39;&quot;;</span><br><span class="line">        User user &#x3D; get(sql,User.class);</span><br><span class="line">        if (user !&#x3D; null)&#123;</span><br><span class="line">        	System.out.println(&quot;登录成功&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">        	System.out.println(&quot;用户名或密码错误!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F; 使用Statement实现对数据表的查询条件</span><br><span class="line">	public &lt;T&gt;T get(String sql,Class&lt;T&gt; calzz)&#123;</span><br><span class="line">		T t &#x3D; null;</span><br><span class="line">		</span><br><span class="line">		Connection conn null;</span><br><span class="line">		Statment st &#x3D; null;</span><br><span class="line">		ResultSet rs &#x3D; null;</span><br><span class="line">		try&#123;</span><br><span class="line">			&#x2F;&#x2F; 1.加载配置文件</span><br><span class="line">			InputStream is &#x3D; StatmentTest.class.getClassLoader().getResourceAsStream(&quot;jdbc.properties&quot;);</span><br><span class="line">			Properties pros &#x3D; new Properties();</span><br><span class="line">			pros.load(is);</span><br><span class="line">			</span><br><span class="line">			&#x2F;&#x2F; 2.读取配置信息</span><br><span class="line">			String user &#x3D; pros.getProperty(&quot;user&quot;);</span><br><span class="line">			String password &#x3D; pro.getProperty(&quot;password&quot;);</span><br><span class="line">			String url &#x3D; pros.getProperty(&quot;url&quot;);</span><br><span class="line">			String driverClass &#x3D; pros.getProperty(&quot;driverClass&quot;);</span><br><span class="line">			</span><br><span class="line">			&#x2F;&#x2F; 3.加载驱动</span><br><span class="line">			Class。forName(driverClass);</span><br><span class="line">			</span><br><span class="line">			&#x2F;&#x2F; 4.获取连接</span><br><span class="line">			conn &#x3D; DriverManger.getConnection(url,user,password);</span><br><span class="line">			</span><br><span class="line">			st &#x3D; conn.createStatement();</span><br><span class="line">			</span><br><span class="line">			rs &#x3D; st.executeQury(sql);</span><br><span class="line">			</span><br><span class="line">			&#x2F;&#x2F; 获取结果集的元数据</span><br><span class="line">			ResultSetMetaDate rsmd &#x3D; rs.getMetaData();</span><br><span class="line">			</span><br><span class="line">			&#x2F;&#x2F; 获取结果集的列数</span><br><span class="line">			int columnCount &#x3D; rsmd.getColumnCount();</span><br><span class="line"></span><br><span class="line">			if (rs.next()) &#123;</span><br><span class="line"></span><br><span class="line">				t &#x3D; clazz.newInstance();</span><br><span class="line"></span><br><span class="line">				for (int i &#x3D; 0; i &lt; columnCount; i++) &#123;</span><br><span class="line">					&#x2F;&#x2F; &#x2F;&#x2F;1. 获取列的名称</span><br><span class="line">					&#x2F;&#x2F; String columnName &#x3D; rsmd.getColumnName(i+1);</span><br><span class="line"></span><br><span class="line">					&#x2F;&#x2F; 1. 获取列的别名</span><br><span class="line">					String columnName &#x3D; rsmd.getColumnLabel(i + 1);</span><br><span class="line"></span><br><span class="line">					&#x2F;&#x2F; 2. 根据列名获取对应数据表中的数据</span><br><span class="line">					Object columnVal &#x3D; rs.getObject(columnName);</span><br><span class="line"></span><br><span class="line">					&#x2F;&#x2F; 3. 将数据表中得到的数据，封装进对象</span><br><span class="line">					Field field &#x3D; clazz.getDeclaredField(columnName);</span><br><span class="line">					field.setAccessible(true);</span><br><span class="line">					field.set(t, columnVal);</span><br><span class="line">				&#125;</span><br><span class="line">				return t;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			&#x2F;&#x2F; 关闭资源</span><br><span class="line">			if (rs !&#x3D; null) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					rs.close();</span><br><span class="line">				&#125; catch (SQLException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			if (st !&#x3D; null) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					st.close();</span><br><span class="line">				&#125; catch (SQLException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			if (conn !&#x3D; null) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125; catch (SQLException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>综上：</p>
<p><img src="/images/JDBC_1/Curd1.png"></p>
</li>
</ul>
<h4 id="PreparedStatment的使用："><a href="#PreparedStatment的使用：" class="headerlink" title="PreparedStatment的使用："></a>PreparedStatment的使用：</h4><p><strong>PreparedStatment介绍：</strong></p>
<ul>
<li>可以通过调用Connection对象的preparedStatement(String sql)方法获取 PreparedStatement对象。</li>
<li><strong>PreparedStatment 接口是 Statement 的子接口，它表示一条编译过的 SQL 语句。</strong></li>
<li>PreparedStatement 对象所代表的SQL语句中的参数用问号(?)来表示，调用PreparedStatement对象的 setXxx() 方法来设置这些参数，setXxx() 方法有两个参数，第一个参数是要设置的 SQL 语句中的参数的索引(从 1 开始)，第二个是设置的 SQL 语句中的参数值。</li>
</ul>
<h4 id="PreparedStatement-VS-Statement"><a href="#PreparedStatement-VS-Statement" class="headerlink" title="PreparedStatement  VS  Statement  :"></a>PreparedStatement  VS  Statement  :</h4><ul>
<li>代码的可读性和可维护性。</li>
<li><strong>PreparedStatement 能最大可能提高性能：</strong><ul>
<li>DBServer会对<strong>预编译</strong>语句提供性能优化。因为预编译语句有可能被重复调用，所以<u>语句在被DBServer的编译器编译后的执行代码被缓存下来，那么下次调用只要是相同的预编译语句就不需要编译，只要将参数直接传入编译过的语句执行代码中就会得到执行。</u></li>
<li>(语法检查、语义检查、翻译成二进制命令，缓存)</li>
</ul>
</li>
<li>PreparedStatement 可以防止 SQL 注入。</li>
</ul>
<h4 id="java与SQL对应数据类型转换表："><a href="#java与SQL对应数据类型转换表：" class="headerlink" title="java与SQL对应数据类型转换表："></a>java与SQL对应数据类型转换表：</h4><table>
<thead>
<tr>
<th>Java类型</th>
<th>SQL类型</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>BIT</td>
</tr>
<tr>
<td>byte</td>
<td>TINYINT</td>
</tr>
<tr>
<td>short</td>
<td>SMALLINT</td>
</tr>
<tr>
<td>int</td>
<td>INTEGER</td>
</tr>
<tr>
<td>long</td>
<td>BIGINT</td>
</tr>
<tr>
<td>String</td>
<td>CHAR,VARCHAR,LONGVARCHAR</td>
</tr>
<tr>
<td>byte   array</td>
<td>BINARY  ,    VAR BINARY</td>
</tr>
<tr>
<td>java.sql.Date</td>
<td>DATE</td>
</tr>
<tr>
<td>java.sql.Time</td>
<td>TIME</td>
</tr>
<tr>
<td>java.sql.Timestamp</td>
<td>TIMESTAMP</td>
</tr>
</tbody></table>
<h4 id="使用PreparedStatement实现增、删、改操作："><a href="#使用PreparedStatement实现增、删、改操作：" class="headerlink" title="使用PreparedStatement实现增、删、改操作："></a>使用PreparedStatement实现增、删、改操作：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 通用的增删、删、改操作 (体现一：增、删、改。体现二：针对不同的表)</span><br><span class="line">public void update(String sql,Obkect ... args)&#123;</span><br><span class="line">	Connection conn &#x3D; null;</span><br><span class="line">	PreparedStatement ps &#x3D; null;</span><br><span class="line">	try&#123;</span><br><span class="line">		&#x2F;&#x2F; 1.获取数据库的连接</span><br><span class="line">		conn - JDBCUtils.getConnection();</span><br><span class="line">		</span><br><span class="line">		&#x2F;&#x2F; 2.获取PreparedStament的实例（或预编译sql语句）</span><br><span class="line">		ps &#x3D; conn.PrepareStatment(sql);</span><br><span class="line">		</span><br><span class="line">		&#x2F;&#x2F; 3.填充占位符</span><br><span class="line">		for(int i &#x3D; 0;i &lt; args.length;i++)&#123;</span><br><span class="line">			ps.setObject(i + 1, args[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		&#x2F;&#x2F; 4.执行sql语句</span><br><span class="line">		ps.execyte();</span><br><span class="line">	&#125;catch (Exception e)&#123;</span><br><span class="line">		pe.printStackTrace();</span><br><span class="line">	&#125;finally&#123;</span><br><span class="line">		&#x2F;&#x2F; 5.关闭资源</span><br><span class="line">		JDBCUtils.closeResource(conn, ps);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用PreparedStatement实现查询操作："><a href="#使用PreparedStatement实现查询操作：" class="headerlink" title="使用PreparedStatement实现查询操作："></a>使用PreparedStatement实现查询操作：</h4><p>// 通用的针对于不同表的查询：返回一个对象 (Version 1.0)</p>


                            <!-- Meta -->
                            <div class="post-meta">
                                <hr>
                                <br>
                                <div class="post-tags">
                                    
                                </div>
                                <div class="post-date">
                                    2021-04-04
                                </div>
                            </div>
                    </div>

                    <!-- Comments -->
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <!-- Disqus Comments -->


                    </div>
                </div>
            </div>
        </article>
</section>

<!-- Image viewer-->

    <!-- Custom picture view-->
    <link href="/css/viewer.min.css" rel="stylesheet" />
    <script
      src="/js/viewer.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    
    <script type="text/javascript">
      // set image viewer
      Viewer.setDefaults({
        zoomRatio: [0.5],
        navbar: false,
        toolbar: false,
        button: false,
        title: [2, (image, imageData) => `${image.alt}`],
        show: function() {
          this.viewer.zoomTo(0.5);
        }
      });
      var imageList = document.getElementsByTagName("img");
      Array.prototype.forEach.call(imageList, element => {
        var viewer = new Viewer(element);
      });
    </script>

    
    <!-- Scripts -->
    <script type="text/javascript">
    console.log("© zchen9 🙋 2015-" + new Date().getFullYear());
</script>
  
    <!-- Google Analytics -->
    

    <!-- Service Worker -->
    <!-- if using service worker -->

    
</body>

</html>